<!DOCTYPE html>
<html lang="">
    <head>
        <meta charset="utf-8">
        
        <title>three.js example</title>
        <style> body {padding: 0; margin: 0;} </style>

        <script src="scripts/three.min.js"></script>
        <script src="scripts/dat.gui.min.js"></script>


        <link rel="stylesheet" type="text/css" href="styles/style.css">

    </head>

    <body>
        <script>
            var renderer = new THREE.WebGLRenderer({antialias: true});
            renderer.setSize( window.innerWidth, window.innerHeight );
            document.body.appendChild(renderer.domElement);

            var scene = new THREE.Scene();

            var camera = new THREE.OrthographicCamera( window.innerWidth/-2, window.innerWidth/2, window.innerHeight/2, window.innerHeight/-2, -2000, 2000 );
            camera.position.z = 500;

            var light = new THREE.AmbientLight( 0xFFFFFF ); // soft white light
            scene.add( light );

            var width, height;
            var texture = new THREE.TextureLoader().load( "images/photo.jpg", function ( texture ) {
                width = texture.image.width;
                height = texture.image.height;
                geometry = new THREE.PlaneGeometry(width, height, 500, 200);
                var plane = new THREE.Mesh(geometry, material);
                scene.add(plane);
                fitTexture();
            } );

            var depthmap = new THREE.TextureLoader().load( "images/depth.jpg" );

            var material = new THREE.MeshStandardMaterial( {
                map: texture,
                metalness: 0,
                displacementMap : depthmap,
                displacementScale: 500,
                displacementBias: -250,
                //wireframe: true      
            } );

            function animate() {
                requestAnimationFrame( animate );
                renderer.render( scene, camera );
            }
            animate();


            /*            window.onmousemove = function(e) {
                camera.position.x = -50*(e.clientX/window.innerWidth-0.5);
                camera.position.y = 50*(e.clientY/window.innerHeight-0.5);
                camera.lookAt(scene.position);
            };

            window.addEventListener( 'resize', onWindowResize, false );*/

            function onWindowResize(){
                camera.left = -window.innerWidth / 2;
                camera.right = window.innerWidth / 2;
                camera.top = window.innerHeight / 2;
                camera.bottom = -window.innerHeight / 2;
                camera.updateProjectionMatrix();
                renderer.setSize( window.innerWidth, window.innerHeight );
                fitTexture();               
            }

            function fitTexture(){
                var wi = width;
                var hi = height;
                var ws = window.innerWidth;
                var hs = window.innerHeight;
                var ri = wi / hi;
                var rs = ws / hs;
                if (rs >= ri) { scale = hs/hi; width = wi * hs/hi; height = hs;} else {scale = ws/wi; width = ws; height = hi * ws/wi;};
                geometry.scale(scale, scale, scale);
            }


            function handleOrientation(event) {
                var x = event.gamma;
                var y = event.beta-45;
                console.log("hello");
                camera.position.x = -x;
                camera.position.y = y;
                camera.lookAt(scene.position);
            }

            window.addEventListener('deviceorientation', handleOrientation);

        </script>
    </body>

</html>
